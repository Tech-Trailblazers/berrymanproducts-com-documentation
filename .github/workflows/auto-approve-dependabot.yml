# -----------------------------
# Workflow Name
# -----------------------------
name: Auto-Approve and Merge Dependabot PRs  # Appears in the Actions tab

# -----------------------------
# Workflow Triggers
# -----------------------------
on:
  workflow_dispatch:                        # âœ… Manual trigger
  pull_request:                             # Also run automatically for Dependabot PRs
    types: [opened, reopened, synchronize]  # These are PR events that trigger it

# -----------------------------
# Workflow Permissions
# -----------------------------
permissions:
  pull-requests: write                      # Needed to approve/merge PRs
  contents: read                            # Safe minimal permission

# -----------------------------
# Job Definition
# -----------------------------
jobs:
  auto-approve:
    if: github.actor == 'dependabot[bot]'   # Only runs for Dependabot
    runs-on: ubuntu-latest                  # GitHub-hosted runner environment

    steps:
      # Step 1: Approve the PR
      - name: Approve Dependabot PR
        run: |
          gh pr review "$PR_URL" --approve
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}

      # Step 2: Enable auto-merge
      - name: Enable auto-merge (squash)
        run: |
          gh pr merge "$PR_URL" --auto --squash
        env:
          PR_URL: ${{ github.event.pull_request.html_url }}
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
